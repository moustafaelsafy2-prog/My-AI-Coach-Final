# =========================
# Netlify configuration
# =========================

[build]
  # لا نحتاج عملية بناء لأن المشروع HTML/JS فقط
  command = ""
  # مجلد النشر: يحتوي index.html في الجذر
  publish = "."

[functions]
  # مكان دوال Netlify (حيث gemini-proxy.js)
  directory = "netlify/functions"
  # تجميع تلقائي سريع وموثوق
  node_bundler = "esbuild"
  # يمكنك إضافة ملفات مضمّنة لاحقًا إن لزم:
  # included_files = ["netlify/functions/**"]

# ---------------------------------
# (اختياري) دعم SPA إن كان لديك روتينج على الواجهة
# أزِل التعليق إذا كنت تحتاج أن تُعيد كل المسارات إلى index.html
# [[redirects]]
#   from = "/*"
#   to = "/index.html"
#   status = 200
# ---------------------------------

# =========================
# Security & Performance Headers
# =========================

# رؤوس أمان عامة لكل الصفحات
[[headers]]
  for = "/*"
  [headers.values]
    # الحماية الأساسية
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=(), payment=(), usb=(), interest-cohort=()"
    Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"

    # ملاحظة: لدينا سكربتات داخلية و Tailwind عبر CDN،
    # لذا نسمح inline و CDN الضروريين. عدّل القائمة لو شددت السياسة.
    Content-Security-Policy = """
      default-src 'self';
      script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdn.jsdelivr.net;
      style-src  'self' 'unsafe-inline' https://fonts.googleapis.com;
      font-src   'self' https://fonts.gstatic.com data:;
      img-src    'self' data: blob:;
      connect-src 'self' https://generativelanguage.googleapis.com https:;
      frame-ancestors 'none';
      base-uri 'self';
      form-action 'self';
    """

# تفعيل التخزين المؤقت للملفات الثابتة (أصول كبيرة إن وجدت)
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# تحسين طباعة/تنزيل الصفحة الرئيسية (لا تخزين طويل لها)
[[headers]]
  for = "/index.html"
  [headers.values]
    Cache-Control = "no-store"

# =========================
# (اختياري) إعادة كتابة للوظائف إذا أردت مسارًا أقصر
# مثال: /api/gemini -> /.netlify/functions/gemini-proxy
# فعّل السطرين التاليين إن أردت استخدام /api/gemini من الواجهة
# =========================
# [[redirects]]
#   from = "/api/gemini"
#   to = "/.netlify/functions/gemini-proxy"
#   status = 200
#   force = true
