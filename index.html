<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø°ÙƒÙŠ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    :root{
      --bg:#0b1020; --card:#0f162e; --muted:#94a3b8; --primary:#7c3aed; --accent:#22c55e;
    }
    html,body{height:100%}
    body{background:linear-gradient(180deg,#0b1020,#0a0f1d); font-family:'Tajawal',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
    [lang="en"] body{font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
    .wrap{max-width:1200px; margin:24px auto; padding:0 16px}
    .card{background:rgba(15,22,46,.88); border:1px solid rgba(255,255,255,.06); border-radius:18px}
    .btn{height:44px; border-radius:12px; padding:0 16px; font-weight:800}
    .btn-primary{background:linear-gradient(45deg,#7c3aed,#a855f7); color:white}
    .btn-ghost{background:rgba(255,255,255,.06); color:#e2e8f0}
    .badge{font-size:12px; padding:6px 10px; border-radius:9999px; background:rgba(124,58,237,.15); color:#c4b5fd}
    .field{display:flex; flex-direction:column; gap:6px}
    .input,.select,.textarea{
      background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1);
      border-radius:12px; padding:.65rem .8rem; color:#e5e7eb; outline:none;
    }
    .input:focus,.select:focus,.textarea:focus{border-color:#a78bfa; box-shadow:0 0 0 3px rgba(167,139,250,.2)}
    .grid-3{
      display:grid; gap:16px;
      grid-template-columns: 1fr; grid-template-areas:
        "profile"
        "diet"
        "lifestyle";
    }
    /* English layout (LTR): profile first at left */
    html[dir="ltr"] .grid-3{
      grid-template-columns: repeat(3,1fr);
      grid-template-areas: "profile diet lifestyle";
    }
    /* Arabic layout (RTL): profile first at right */
    html[dir="rtl"] .grid-3{
      grid-template-columns: repeat(3,1fr);
      grid-template-areas: "lifestyle diet profile";
    }
    .box{padding:18px}
    .profile{grid-area:profile}
    .diet{grid-area:diet}
    .lifestyle{grid-area:lifestyle}
    @media (max-width:1024px){
      .grid-3{grid-template-columns:1fr; grid-template-areas:"profile" "diet" "lifestyle";}
    }
    .h-title{font-weight:800; color:#e2e8f0; display:flex; align-items:center; gap:8px}
    .h-sub{color:#94a3b8; font-size:.9rem}
    .divider{height:1px; background:rgba(255,255,255,.08); margin:12px 0}
    .sticky-actions{position:sticky; bottom:0; backdrop-filter:blur(10px); background:rgba(11,16,32,.6); border-top:1px solid rgba(255,255,255,.06)}
    .waiting{animation:pulse 1.6s infinite}
    @keyframes pulse{0%{opacity:.4}50%{opacity:1}100%{opacity:.4}}
    .print-hide{display:block}
    @media print{
      .print-hide{display:none}
      body{background:white}
      .card{border:none}
    }
    /* RTL/LTR logical alignment helpers */
    .ltr-text{direction:ltr; text-align:left}
    .rtl-text{direction:rtl; text-align:right}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Top Bar -->
    <header class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <div class="badge">AI</div>
        <div>
          <div class="text-slate-100 font-extrabold" id="appTitle">Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø°ÙƒÙŠ</div>
          <div class="text-slate-400 text-sm" id="appTag">Ø®Ø·Ø© Ø¯Ù‚ÙŠÙ‚Ø© 100% Ù„Ù„ØªØºØ°ÙŠØ© ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„Ù…ÙƒÙ…Ù„Ø§Øª â€“ Ù…Ø®ØµØµØ© Ù„Ùƒ</div>
        </div>
      </div>
      <div class="flex items-center gap-2 print-hide">
        <button id="btnAr" class="btn btn-ghost">Ø¹Ø±Ø¨Ù‰</button>
        <button id="btnEn" class="btn btn-ghost">EN</button>
        <button id="btnTheme" class="btn btn-ghost" title="Theme">ğŸŒ“</button>
      </div>
    </header>

    <!-- Helper note -->
    <div class="card box mb-4">
      <div class="h-title">
        <span>â„¹ï¸</span><span id="helperTitle">Ù„Ù†ÙÙ†Ø´Ø¦ Ø£ÙØ¶Ù„ Ø®Ø·Ø© Ù…Ø­ÙƒÙ…Ø© Ù„Ù‡Ø¯ÙÙƒ</span>
      </div>
      <div class="h-sub mt-1" id="helperDesc">
        Ø³Ù†ÙˆÙ„Ù‘Ø¯ Ø§Ù„Ø®Ø·Ø© Ù‚Ø³Ù…Ù‹Ø§ Ø¨Ø¹Ø¯ Ù‚Ø³Ù…: ØªØ±Ø­ÙŠØ¨ â†’ ØªØ­Ù„ÙŠÙ„ â†’ Ø§Ù„Ù…Ø³Ù…ÙˆØ­/Ø§Ù„Ù…Ù…Ù†ÙˆØ¹ â†’ Ø§Ù„ØµÙŠØ§Ù… Ø§Ù„Ù…ØªÙ‚Ø·Ø¹ (Ø¥Ù† Ù„Ø²Ù…) â†’ Ø§Ù„ØªØºØ°ÙŠØ© ÙŠÙˆÙ…Ù‹Ø§ Ø¨ÙŠÙˆÙ… (7) â†’ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙŠÙˆÙ…Ù‹Ø§ Ø¨ÙŠÙˆÙ… (7) â†’ Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª â†’ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© â†’ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª â†’ Ø§Ù„Ø³Ù„Ø§Ù…Ø© â†’ Ø¥ØºÙ„Ø§Ù‚.
      </div>
    </div>

    <!-- 3-column form grid -->
    <form id="form" class="grid-3">
      <!-- Lifestyle & Training -->
      <section class="card lifestyle">
        <div class="box">
          <div class="h-title">ğŸƒâ€â™‚ï¸ <span id="secLifestyle">Ù†Ù…Ø· Ø§Ù„Ø­ÙŠØ§Ø© ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨</span></div>
          <div class="divider"></div>

          <div class="grid md:grid-cols-2 gap-3">
            <div class="field">
              <label id="lblWork">Ø§Ù„Ø¹Ù…Ù„/Ø§Ù„Ù†Ø´Ø§Ø·</label>
              <select id="work" class="select">
                <option value="sedentary">Ù…ÙƒØªØ¨ÙŠ</option>
                <option value="light">Ù†Ø´Ø§Ø· Ø®ÙÙŠÙ</option>
                <option value="moderate">Ù†Ø´Ø§Ø· Ù…ØªÙˆØ³Ø·</option>
                <option value="active">Ù†Ø´Ø§Ø· Ø¹Ø§Ù„Ù</option>
              </select>
            </div>
            <div class="field">
              <label id="lblSteps">Ø§Ù„Ø®Ø·ÙˆØ§Øª/Ø§Ù„ÙŠÙˆÙ…</label>
              <input id="steps" type="number" class="input" inputmode="numeric" placeholder="6000" />
            </div>
            <div class="field">
              <label id="lblSleep">Ø§Ù„Ù†ÙˆÙ… (Ø³)</label>
              <select id="sleep" class="select">
                <option value="low">Ù…Ù†Ø®ÙØ¶</option>
                <option value="medium">Ù…ØªÙˆØ³Ø·</option>
                <option value="high">Ù…Ø±ØªÙØ¹</option>
              </select>
            </div>
            <div class="field">
              <label id="lblStress">Ø§Ù„ØªÙˆØªØ±</label>
              <select id="stress" class="select">
                <option value="low">Ù…Ù†Ø®ÙØ¶</option>
                <option value="medium">Ù…ØªÙˆØ³Ø·</option>
                <option value="high">Ù…Ø±ØªÙØ¹</option>
              </select>
            </div>
            <div class="field">
              <label id="lblPlace">Ù…ÙƒØ§Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨</label>
              <input id="place" class="input" placeholder="Ù†Ø§Ø¯ÙŠ / Ù…Ù†Ø²Ù„..." />
            </div>
            <div class="field">
              <label id="lblSession">Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© (Ø¯)</label>
              <input id="session" type="number" class="input" inputmode="numeric" placeholder="60" />
            </div>
          </div>

          <div class="divider"></div>
          <div class="h-title text-sm" id="quickFit">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ù…Ø¨Ø³Ø·</div>
          <div class="grid md:grid-cols-3 gap-3 mt-2">
            <div class="field">
              <label id="lblRHR">Ø§Ù„Ù†Ø¨Ø¶ Ø±Ø§Ø­Ø© (Ù†Ø¨/Ø¯)</label>
              <input id="rhr" type="number" class="input" inputmode="numeric" />
            </div>
            <div class="field">
              <label id="lblPushups">Ø£Ù‚ØµÙ‰ Ø¶ØºØ·</label>
              <input id="pushups" type="number" class="input" inputmode="numeric" />
            </div>
            <div class="field">
              <label id="lblRun1k">Ø²Ù…Ù† 1ÙƒÙ… (Ø¯:Ø«)</label>
              <input id="run1k" class="input ltr-text" placeholder="6:30" />
            </div>
          </div>

          <div class="divider"></div>
          <div class="grid md:grid-cols-2 gap-3">
            <div class="field">
              <label id="lblDays">Ø£ÙŠØ§Ù… Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ØªØ§Ø­Ø©</label>
              <div class="grid grid-cols-4 gap-2 text-sm text-slate-300">
                <label><input type="checkbox" class="mr-1 align-middle" value="sat" /> <span id="dSat">Ø§Ù„Ø³Ø¨Øª</span></label>
                <label><input type="checkbox" class="mr-1 align-middle" value="sun" /> <span id="dSun">Ø§Ù„Ø£Ø­Ø¯</span></label>
                <label><input type="checkbox" class="mr-1 align-middle" value="mon" /> <span id="dMon">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</span></label>
                <label><input type="checkbox" class="mr-1 align-middle" value="tue" /> <span id="dTue">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</span></label>
                <label><input type="checkbox" class="mr-1 align-middle" value="wed" /> <span id="dWed">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</span></label>
                <label><input type="checkbox" class="mr-1 align-middle" value="thu" /> <span id="dThu">Ø§Ù„Ø®Ù…ÙŠØ³</span></label>
                <label><input type="checkbox" class="mr-1 align-middle" value="fri" /> <span id="dFri">Ø§Ù„Ø¬Ù…Ø¹Ø©</span></label>
              </div>
            </div>
            <div class="field">
              <label id="lblEq">Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</label>
              <input id="equipment" class="input" placeholder="Ø¨Ø§Ø±ØŒ Ø¯Ù…Ø¨Ù„..." />
            </div>
            <div class="field">
              <label id="lblExp">Ø§Ù„Ø®Ø¨Ø±Ø©</label>
              <select id="experience" class="select">
                <option value="beginner">Ù…Ø¨ØªØ¯Ø¦ (0-6 Ø£Ø´Ù‡Ø±)</option>
                <option value="intermediate">Ù…ØªÙˆØ³Ø· (6-24 Ø´Ù‡Ø±)</option>
                <option value="advanced">Ù…ØªÙ‚Ø¯Ù… (+24 Ø´Ù‡Ø±)</option>
              </select>
            </div>
            <div class="field">
              <label id="lblRpe">RPE</label>
              <input id="rpe" type="number" class="input" inputmode="numeric" placeholder="8" />
            </div>
            <div class="field">
              <label id="lblCaffeine">ÙƒØ§ÙÙŠÙŠÙ† (Ø£ÙƒÙˆØ§Ø¨/ÙŠÙˆÙ…)</label>
              <input id="caffeine" type="number" class="input" inputmode="numeric" />
            </div>
            <div class="field">
              <label id="lblInj">Ø¥ØµØ§Ø¨Ø§Øª/Ù‚ÙŠÙˆØ¯</label>
              <input id="injuries" class="input" />
            </div>
          </div>
        </div>
      </section>

      <!-- Diet & Preferences -->
      <section class="card diet">
        <div class="box">
          <div class="h-title">ğŸ½ï¸ <span id="secDiet">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØºØ°Ø§Ø¦ÙŠ ÙˆØ§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª</span></div>
          <div class="divider"></div>

          <div class="grid md:grid-cols-2 gap-3">
            <div class="field">
              <label id="lblGoals">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù (Ù…ØªØ¹Ø¯Ø¯)</label>
              <div class="grid grid-cols-2 gap-2 text-sm text-slate-300">
                <label><input type="checkbox" value="fat" class="mr-1" /> <span id="gFat">Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¯Ù‡ÙˆÙ†</span></label>
                <label><input type="checkbox" value="muscle" class="mr-1" /> <span id="gMuscle">Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª</span></label>
                <label><input type="checkbox" value="strength" class="mr-1" /> <span id="gStrength">Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‚ÙˆØ©</span></label>
                <label><input type="checkbox" value="endurance" class="mr-1" /> <span id="gEndurance">Ø§Ù„ØªØ­Ù…Ù„</span></label>
                <label class="col-span-2"><input type="checkbox" value="health" class="mr-1" /> <span id="gHealth">ØµØ­Ø© Ø¹Ø§Ù…Ø©</span></label>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div class="field">
                <label id="lblMeals">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª/Ø§Ù„ÙŠÙˆÙ…</label>
                <select id="meals" class="select">
                  <option value="3">3</option><option value="4">4</option>
                  <option value="5">5</option><option value="2">2</option>
                </select>
              </div>
              <div class="field">
                <label id="lblDietType">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙØ¶Ù„</label>
                <select id="dietType" class="select">
                  <option value="balanced">Balanced</option>
                  <option value="lowcarb">Low-Carb</option>
                  <option value="med">Mediterranean</option>
                  <option value="keto">Keto</option>
                  <option value="if">Intermittent Fasting</option>
                  <option value="vegan">Vegan</option>
                </select>
              </div>
              <div class="field">
                <label id="lblCuisine">Ø§Ù„Ù…Ø·Ø¨Ø® Ø§Ù„Ù…ÙØ¶Ù„</label>
                <select id="cuisine" class="select">
                  <option value="arab">Arabic/Middle Eastern</option>
                  <option value="med">Mediterranean</option>
                  <option value="indian">Indian</option>
                  <option value="western">Western</option>
                </select>
              </div>
              <div class="field">
                <label id="lblPrep">Ø²Ù…Ù† Ø§Ù„ØªØ­Ø¶ÙŠØ± (Ø¯)</label>
                <input id="prep" type="number" class="input" inputmode="numeric" placeholder="20" />
              </div>
              <div class="field">
                <label id="lblBudget">Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø´Ù‡Ø±ÙŠØ© ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</label>
                <div class="flex gap-2">
                  <input id="budget" type="number" class="input flex-1" inputmode="numeric" placeholder="0" />
                  <select id="currency" class="select">
                    <option value="auto" selected>Auto</option>
                    <option value="USD">USD</option><option value="SAR">SAR</option>
                    <option value="AED">AED</option><option value="EGP">EGP</option>
                    <option value="KWD">KWD</option><option value="QAR">QAR</option>
                  </select>
                </div>
                <div class="text-xs text-slate-400" id="budgetHint">Ø³Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©.</div>
              </div>
              <div class="field">
                <label id="lblAllergy">Ø£Ø·Ø¹Ù…Ø© Ù„Ø§ ØªØ±ØºØ¨/Ø­Ø³Ø§Ø³ÙŠØ©</label>
                <input id="avoid" class="input" placeholder="Ø¬Ù„ÙˆØªÙŠÙ†ØŒ Ù„Ø§ÙƒØªÙˆØ²..." />
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="h-title text-sm" id="musclesHeader">Ø¹Ø¶Ù„Ø§Øª ØªØ­ØªØ§Ø¬ Ø¹Ù†Ø§ÙŠØ© Ø®Ø§ØµØ©</div>
          <!-- Muscles with per-muscle issue -->
          <div class="grid md:grid-cols-2 gap-3 mt-2" id="musclesWrap">
            <!-- Generated by JS for consistency in both languages -->
          </div>

          <div class="divider"></div>
          <div class="field">
            <label id="lblChallenges">ØªØ­Ø¯ÙŠØ§Øª Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©</label>
            <textarea id="challenges" class="textarea" rows="2" placeholder="Ø¬ÙˆØ¹ Ø´Ø¯ÙŠØ¯ØŒ Ù…Ù„Ù„ Ù…Ù† Ø§Ù„Ø·Ø¹Ø§Ù…ØŒ Ø¥ØµØ§Ø¨Ø§Øª..."></textarea>
          </div>
          <div class="field">
            <label id="lblMotivation">Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ØªØ­ÙÙŠØ² Ø§Ù„Ù…ÙØ¶Ù„</label>
            <select id="motivation" class="select">
              <option value="direct">Ø¹Ù…Ù„ÙŠ ÙˆÙ…Ø¨Ø§Ø´Ø±</option>
              <option value="supportive">ØªØ´Ø¬ÙŠØ¹ÙŠ/Ù…Ø±Ù†</option>
              <option value="strict">ØµØ§Ø±Ù… ÙˆÙ…Ù†Ø¶Ø¨Ø·</option>
            </select>
          </div>
        </div>
      </section>

      <!-- Profile (always first column logically, re-ordered by CSS per dir) -->
      <section class="card profile">
        <div class="box">
          <div class="h-title">ğŸ‘¤ <span id="secProfile">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span></div>
          <div class="divider"></div>

          <div class="grid md:grid-cols-2 gap-3">
            <div class="field">
              <label id="lblName">Ø§Ù„Ø§Ø³Ù…</label>
              <input id="name" class="input" />
            </div>
            <div class="field">
              <label id="lblAge">Ø§Ù„Ø¹Ù…Ø±</label>
              <input id="age" type="number" class="input" inputmode="numeric" />
            </div>
            <div class="field">
              <label id="lblHeight">Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label>
              <input id="height" type="number" class="input" inputmode="numeric" />
            </div>
            <div class="field">
              <label id="lblWeight">Ø§Ù„ÙˆØ²Ù† (ÙƒØº)</label>
              <input id="weight" type="number" class="input" inputmode="numeric" />
            </div>
            <div class="field">
              <label id="lblBf">% Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù‡ÙˆÙ† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input id="bodyfat" type="number" class="input" inputmode="numeric" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ" />
            </div>
            <div class="field">
              <label id="lblWaist">Ù…Ø­ÙŠØ· Ø§Ù„Ø®ØµØ± (Ø³Ù…) (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input id="waist" type="number" class="input" inputmode="numeric" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ" />
            </div>
            <div class="field">
              <label id="lblSex">Ø§Ù„Ø¬Ù†Ø³</label>
              <select id="sex" class="select">
                <option value="male">Ø°ÙƒØ±</option><option value="female">Ø£Ù†Ø«Ù‰</option>
              </select>
            </div>
            <div class="field">
              <label id="lblGoalNum">Ù‡Ø¯Ù Ø±Ù‚Ù…ÙŠ (ÙˆØ²Ù† Ù…Ø³ØªÙ‡Ø¯Ù ÙƒØº) (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input id="targetWeight" type="number" class="input" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 84" />
            </div>
            <div class="field">
              <label id="lblGoalDate">Ù…ÙˆØ¹Ø¯ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input id="targetDate" type="date" class="input" />
            </div>
          </div>

          <div class="divider"></div>
          <div class="h-title text-sm" id="medicalTitle">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ©</div>
          <div class="grid md:grid-cols-2 gap-3 mt-2">
            <div class="field">
              <div class="grid grid-cols-2 gap-2 text-sm text-slate-300" id="medicalList">
                <!-- filled by JS: checklist + others/supplements/medications -->
              </div>
            </div>
            <div class="grid gap-3">
              <div class="field">
                <label id="lblOtherCond">Ø£Ù…Ø±Ø§Ø¶ Ø£Ø®Ø±Ù‰</label>
                <input id="otherConditions" class="input" />
              </div>
              <div class="field">
                <label id="lblMedications">Ø£Ø¯ÙˆÙŠØ© Ø­Ø§Ù„ÙŠØ©</label>
                <input id="medications" class="input" />
              </div>
              <div class="field">
                <label id="lblSupps">Ù…ÙƒÙ…Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ©</label>
                <input id="supplements" class="input" />
              </div>
            </div>
          </div>
        </div>
      </section>
    </form>

    <!-- Generate / Print / PDF -->
    <div class="sticky-actions mt-5 card box print-hide">
      <div class="flex flex-wrap items-center gap-3 justify-between">
        <div class="text-slate-300 text-sm" id="genHint">
          âœ… Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ â€œØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©â€ Ø³Ù†ÙÙ†Ø´Ø¦ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠÙƒØªÙ…Ù„ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.
        </div>
        <div class="flex gap-2">
          <button id="btnGenerate" class="btn btn-primary">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©</button>
          <button id="btnPrint" class="btn btn-ghost">Ø·Ø¨Ø§Ø¹Ø©</button>
          <button id="btnPDF" class="btn btn-ghost">PDF</button>
        </div>
      </div>
    </div>

    <!-- Output -->
    <article id="output" class="card box mt-4">
      <div id="wait" class="hidden waiting text-slate-300"></div>
      <div id="plan" class="prose prose-invert max-w-none"></div>
    </article>

    <footer class="text-center text-slate-500 text-sm mt-6">
      Powered by Mustafa Elsafy 2025 â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©
    </footer>
  </div>

  <script>
    /* =========================
       I18N
    ========================== */
    const i18n = {
      ar: {
        title: "Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø°ÙƒÙŠ",
        tag: "Ø®Ø·Ø© Ø¯Ù‚ÙŠÙ‚Ø© 100% Ù„Ù„ØªØºØ°ÙŠØ© ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„Ù…ÙƒÙ…Ù„Ø§Øª â€“ Ù…Ø®ØµØµØ© Ù„Ùƒ",
        helperTitle: "Ù„Ù†ÙÙ†Ø´Ø¦ Ø£ÙØ¶Ù„ Ø®Ø·Ø© Ù…Ø­ÙƒÙ…Ø© Ù„Ù‡Ø¯ÙÙƒ",
        helperDesc: "Ø³Ù†ÙˆÙ„Ù‘Ø¯ Ø§Ù„Ø®Ø·Ø© Ù‚Ø³Ù…Ù‹Ø§ Ø¨Ø¹Ø¯ Ù‚Ø³Ù…: ØªØ±Ø­ÙŠØ¨ â†’ ØªØ­Ù„ÙŠÙ„ â†’ Ø§Ù„Ù…Ø³Ù…ÙˆØ­/Ø§Ù„Ù…Ù…Ù†ÙˆØ¹ â†’ Ø§Ù„ØµÙŠØ§Ù… Ø§Ù„Ù…ØªÙ‚Ø·Ø¹ (Ø¥Ù† Ù„Ø²Ù…) â†’ Ø§Ù„ØªØºØ°ÙŠØ© ÙŠÙˆÙ…Ù‹Ø§ Ø¨ÙŠÙˆÙ… (7) â†’ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙŠÙˆÙ…Ù‹Ø§ Ø¨ÙŠÙˆÙ… (7) â†’ Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª â†’ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© â†’ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª â†’ Ø§Ù„Ø³Ù„Ø§Ù…Ø© â†’ Ø¥ØºÙ„Ø§Ù‚.",
        secLifestyle: "Ù†Ù…Ø· Ø§Ù„Ø­ÙŠØ§Ø© ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨",
        secDiet: "Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØºØ°Ø§Ø¦ÙŠ ÙˆØ§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª",
        secProfile: "Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ",
        work: "Ø§Ù„Ø¹Ù…Ù„/Ø§Ù„Ù†Ø´Ø§Ø·",
        steps: "Ø§Ù„Ø®Ø·ÙˆØ§Øª/Ø§Ù„ÙŠÙˆÙ…",
        sleep: "Ø§Ù„Ù†ÙˆÙ… (Ø³)",
        stress: "Ø§Ù„ØªÙˆØªØ±",
        place: "Ù…ÙƒØ§Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨",
        session: "Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© (Ø¯)",
        quickFit: "Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ù…Ø¨Ø³Ø·",
        rhr: "Ø§Ù„Ù†Ø¨Ø¶ Ø±Ø§Ø­Ø© (Ù†Ø¨/Ø¯)",
        pushups: "Ø£Ù‚ØµÙ‰ Ø¶ØºØ·",
        run1k: "Ø²Ù…Ù† 1ÙƒÙ… (Ø¯:Ø«)",
        days: "Ø£ÙŠØ§Ù… Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ØªØ§Ø­Ø©",
        eq: "Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©",
        exp: "Ø§Ù„Ø®Ø¨Ø±Ø©",
        rpe: "RPE",
        caffeine: "ÙƒØ§ÙÙŠÙŠÙ† (Ø£ÙƒÙˆØ§Ø¨/ÙŠÙˆÙ…)",
        injuries: "Ø¥ØµØ§Ø¨Ø§Øª/Ù‚ÙŠÙˆØ¯",
        goals: "Ø§Ù„Ø£Ù‡Ø¯Ø§Ù (Ù…ØªØ¹Ø¯Ø¯)",
        gFat: "Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¯Ù‡ÙˆÙ†",
        gMuscle: "Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª",
        gStrength: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‚ÙˆØ©",
        gEndurance: "Ø§Ù„ØªØ­Ù…Ù„",
        gHealth: "ØµØ­Ø© Ø¹Ø§Ù…Ø©",
        meals: "Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª/Ø§Ù„ÙŠÙˆÙ…",
        dietType: "Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙØ¶Ù„",
        cuisine: "Ø§Ù„Ù…Ø·Ø¨Ø® Ø§Ù„Ù…ÙØ¶Ù„",
        prep: "Ø²Ù…Ù† Ø§Ù„ØªØ­Ø¶ÙŠØ± (Ø¯)",
        budget: "Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø´Ù‡Ø±ÙŠØ© ØªÙ‚Ø±ÙŠØ¨ÙŠØ©",
        budgetHint: "Ø³Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©.",
        avoid: "Ø£Ø·Ø¹Ù…Ø© Ù„Ø§ ØªØ±ØºØ¨/Ø­Ø³Ø§Ø³ÙŠØ©",
        musclesHeader: "Ø¹Ø¶Ù„Ø§Øª ØªØ­ØªØ§Ø¬ Ø¹Ù†Ø§ÙŠØ© Ø®Ø§ØµØ©",
        challenges: "ØªØ­Ø¯ÙŠØ§Øª Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©",
        motivation: "Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ØªØ­ÙÙŠØ² Ø§Ù„Ù…ÙØ¶Ù„",
        name: "Ø§Ù„Ø§Ø³Ù…",
        age: "Ø§Ù„Ø¹Ù…Ø±",
        height: "Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)",
        weight: "Ø§Ù„ÙˆØ²Ù† (ÙƒØº)",
        bodyfat: "% Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù‡ÙˆÙ† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
        waist: "Ù…Ø­ÙŠØ· Ø§Ù„Ø®ØµØ± (Ø³Ù…) (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
        sex: "Ø§Ù„Ø¬Ù†Ø³",
        targetWeight: "Ù‡Ø¯Ù Ø±Ù‚Ù…ÙŠ (ÙˆØ²Ù† Ù…Ø³ØªÙ‡Ø¯Ù ÙƒØº) (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
        targetDate: "Ù…ÙˆØ¹Ø¯ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
        medTitle: "Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ©",
        otherCond: "Ø£Ù…Ø±Ø§Ø¶ Ø£Ø®Ø±Ù‰",
        meds: "Ø£Ø¯ÙˆÙŠØ© Ø­Ø§Ù„ÙŠØ©",
        supps: "Ù…ÙƒÙ…Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ©",
        btnGenerate: "ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©",
        btnPrint: "Ø·Ø¨Ø§Ø¹Ø©",
        btnPDF: "PDF",
        waiting: "ğŸ§  Ù†ÙØ¹Ø¯Ù‘ Ø®Ø·ØªÙƒ Ø¨Ø¹Ù†Ø§ÙŠØ©â€¦ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠÙƒØªÙ…Ù„ ÙƒÙ„ Ù‚Ø³Ù….",
        daysNames: ["Ø§Ù„Ø³Ø¨Øª","Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©"],
        workVals: ["Ù…ÙƒØªØ¨ÙŠ","Ù†Ø´Ø§Ø· Ø®ÙÙŠÙ","Ù†Ø´Ø§Ø· Ù…ØªÙˆØ³Ø·","Ù†Ø´Ø§Ø· Ø¹Ø§Ù„Ù"],
        sleepVals: ["Ù…Ù†Ø®ÙØ¶","Ù…ØªÙˆØ³Ø·","Ù…Ø±ØªÙØ¹"],
        motivationVals: ["Ø¹Ù…Ù„ÙŠ ÙˆÙ…Ø¨Ø§Ø´Ø±","ØªØ´Ø¬ÙŠØ¹ÙŠ/Ù…Ø±Ù†","ØµØ§Ø±Ù… ÙˆÙ…Ù†Ø¶Ø¨Ø·"],
        muscleList: [
          ["chest","Ø§Ù„ØµØ¯Ø±"],["back","Ø§Ù„Ø¸Ù‡Ø±"],["shoulders","Ø§Ù„Ø£ÙƒØªØ§Ù"],["biceps","Ø§Ù„Ø¨Ø§ÙŠØ³Ø¨Ø³"],["triceps","Ø§Ù„ØªØ±Ø§ÙŠØ³Ø¨Ø³"],
          ["quads","Ø§Ù„Ø£Ø±Ø¬Ù„ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©"],["hamstrings","Ø§Ù„Ø£Ø±Ø¬Ù„ Ø§Ù„Ø®Ù„ÙÙŠØ©"],["glutes","Ø§Ù„Ù…Ø¤Ø®Ø±Ø©"],["calves","Ø§Ù„Ø³Ù…Ø§Ù†Ø©"],["abs","Ø§Ù„Ø¨Ø·Ù†"]
        ],
        medicalList: [
          ["hypertension","Ø¶ØºØ· Ø§Ù„Ø¯Ù…"],["diabetes","Ø§Ù„Ø³ÙƒØ±ÙŠ"],["insulin","Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„Ø£Ù†Ø³ÙˆÙ„ÙŠÙ†"],["thyroid","Ø§Ù„ØºØ¯Ø© Ø§Ù„Ø¯Ø±Ù‚ÙŠØ©"],
          ["fatty","Ø§Ù„ÙƒØ¨Ø¯ Ø§Ù„Ø¯Ù‡Ù†ÙŠ"],["hormonal","Ù…Ø´Ø§ÙƒÙ„ Ù‡Ø±Ù…ÙˆÙ†ÙŠØ©"],["joint","Ù…Ø´Ø§ÙƒÙ„ Ù…ÙØ§ØµÙ„/Ø±ÙƒØ¨"],["heart","Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨"],
          ["ulcer","Ù‚Ø±Ø­Ø©/Ù‚ÙˆÙ„ÙˆÙ† Ø¹ØµØ¨ÙŠ"],["gerd","Ø§Ø±ØªØ¬Ø§Ø¹/Ø­Ù…ÙˆØ¶Ø©"],["gluten","Ø­Ø³Ø§Ø³ÙŠØ© Ø¬Ù„ÙˆØªÙŠÙ†"],["lactose","Ø¹Ø¯Ù… ØªØ­Ù…Ù„ Ù„Ø§ÙƒØªÙˆØ²"]
        ]
      },
      en: {
        title: "Intelligent Health Coach",
        tag: "100% precise plan for nutrition, training and supplements â€” fully personalized",
        helperTitle: "Let's build the best plan for your goal",
        helperDesc: "We will generate the plan section-by-section: Welcome â†’ Analysis â†’ Allowed/Limits â†’ Intermittent Fasting (if relevant) â†’ Nutrition day-by-day (7) â†’ Training day-by-day (7) â†’ Supplements â†’ Progression â†’ Troubleshooting â†’ Safety â†’ Closing.",
        secLifestyle: "Lifestyle & Training",
        secDiet: "Diet & Preferences",
        secProfile: "Profile",
        work: "Work/Activity",
        steps: "Steps/day",
        sleep: "Sleep",
        stress: "Stress",
        place: "Training place",
        session: "Session length (min)",
        quickFit: "Quick Fitness Test",
        rhr: "Resting HR (bpm)",
        pushups: "Max push-ups",
        run1k: "1 km time (m:s)",
        days: "Available training days",
        eq: "Available equipment",
        exp: "Experience",
        rpe: "RPE",
        caffeine: "Caffeine/day (cups)",
        injuries: "Injuries/constraints",
        goals: "Goals (multi-select)",
        gFat: "Fat Loss",
        gMuscle: "Build Muscle",
        gStrength: "Strength",
        gEndurance: "Endurance",
        gHealth: "General Health",
        meals: "Meals per day",
        dietType: "Preferred diet",
        cuisine: "Cuisine",
        prep: "Prep time (min)",
        budget: "Monthly budget",
        budgetHint: "We'll try to stay within the monthly budget.",
        avoid: "Foods to avoid / allergies",
        musclesHeader: "Muscles needing special focus",
        challenges: "Past challenges with plans",
        motivation: "Preferred motivation style",
        name: "Name",
        age: "Age",
        height: "Height (cm)",
        weight: "Weight (kg)",
        bodyfat: "Body fat % (optional)",
        waist: "Waist (cm) (optional)",
        sex: "Sex",
        targetWeight: "Numeric target (kg) (optional)",
        targetDate: "Target date (optional)",
        medTitle: "Medical status",
        otherCond: "Other conditions",
        meds: "Current medications",
        supps: "Current supplements",
        btnGenerate: "Generate Plan",
        btnPrint: "Print",
        btnPDF: "PDF",
        waiting: "ğŸ§  Crafting your plan with careâ€¦ please wait until all sections complete.",
        daysNames: ["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],
        workVals: ["Sedentary","Light","Moderate","Active"],
        sleepVals: ["Low","Medium","High"],
        motivationVals: ["Direct/Practical","Supportive","Strict/Disciplined"],
        muscleList: [
          ["chest","Chest"],["back","Back"],["shoulders","Shoulders"],["biceps","Biceps"],["triceps","Triceps"],
          ["quads","Quads"],["hamstrings","Hamstrings"],["glutes","Glutes"],["calves","Calves"],["abs","Abs"]
        ],
        medicalList: [
          ["hypertension","Hypertension"],["diabetes","Diabetes"],["insulin","Insulin Resistance"],["thyroid","Thyroid issues"],
          ["fatty","Fatty Liver"],["hormonal","Hormonal issues"],["joint","Joint/Knee problems"],["heart","Heart disease"],
          ["ulcer","IBD/Ulcer"],["gerd","GERD/Reflux"],["gluten","Gluten intolerance"],["lactose","Lactose intolerance"]
        ]
      }
    };

    /* =========================
       Language / Theme
    ========================== */
    let lang = (navigator.language||'ar').toLowerCase().startsWith('ar') ? 'ar' : 'en';
    const $ = sel => document.querySelector(sel);

    function fillStatic() {
      const t = i18n[lang];
      document.documentElement.lang = lang;
      document.documentElement.dir  = (lang==='ar') ? 'rtl' : 'ltr';
      $('#appTitle').textContent = t.title;
      $('#appTag').textContent   = t.tag;
      $('#helperTitle').textContent = t.helperTitle;
      $('#helperDesc').textContent  = t.helperDesc;
      $('#secLifestyle').textContent= t.secLifestyle;
      $('#secDiet').textContent     = t.secDiet;
      $('#secProfile').textContent  = t.secProfile;
      $('#lblWork').textContent     = t.work;
      $('#lblSteps').textContent    = t.steps;
      $('#lblSleep').textContent    = t.sleep;
      $('#lblStress').textContent   = t.stress;
      $('#lblPlace').textContent    = t.place;
      $('#lblSession').textContent  = t.session;
      $('#quickFit').textContent    = t.quickFit;
      $('#lblRHR').textContent      = t.rhr;
      $('#lblPushups').textContent  = t.pushups;
      $('#lblRun1k').textContent    = t.run1k;
      $('#lblDays').textContent     = t.days;
      $('#lblEq').textContent       = t.eq;
      $('#lblExp').textContent      = t.exp;
      $('#lblRpe').textContent      = t.rpe;
      $('#lblCaffeine').textContent = t.caffeine;
      $('#lblInj').textContent      = t.injuries;
      $('#lblGoals').textContent    = t.goals;
      $('#gFat').textContent        = t.gFat;
      $('#gMuscle').textContent     = t.gMuscle;
      $('#gStrength').textContent   = t.gStrength;
      $('#gEndurance').textContent  = t.gEndurance;
      $('#gHealth').textContent     = t.gHealth;
      $('#lblMeals').textContent    = t.meals;
      $('#lblDietType').textContent = t.dietType;
      $('#lblCuisine').textContent  = t.cuisine;
      $('#lblPrep').textContent     = t.prep;
      $('#lblBudget').textContent   = t.budget;
      $('#budgetHint').textContent  = t.budgetHint;
      $('#lblAllergy').textContent  = t.avoid;
      $('#musclesHeader').textContent= t.musclesHeader;
      $('#lblChallenges').textContent= t.challenges;
      $('#lblMotivation').textContent = t.motivation;
      $('#lblName').textContent     = t.name;
      $('#lblAge').textContent      = t.age;
      $('#lblHeight').textContent   = t.height;
      $('#lblWeight').textContent   = t.weight;
      $('#lblBf').textContent       = t.bodyfat;
      $('#lblWaist').textContent    = t.waist;
      $('#lblSex').textContent      = t.sex;
      $('#lblGoalNum').textContent  = t.targetWeight;
      $('#lblGoalDate').textContent = t.targetDate;
      $('#medicalTitle').textContent= t.medTitle;
      $('#lblOtherCond').textContent= t.otherCond;
      $('#lblMedications').textContent= t.meds;
      $('#lblSupps').textContent    = t.supps;
      $('#btnGenerate').textContent = t.btnGenerate;
      $('#btnPrint').textContent    = t.btnPrint;
      $('#btnPDF').textContent      = t.btnPDF;
      $('#genHint').textContent     = (lang==='ar')
        ? "âœ… Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ â€œØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©â€ Ø³Ù†ÙÙ†Ø´Ø¦ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠÙƒØªÙ…Ù„ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„."
        : "âœ… When you click â€œGenerate Planâ€, weâ€™ll generate sections in order. Please wait until everything completes.";
      $('#wait').textContent        = t.waiting;

      // Select options text
      const workMap = t.workVals;
      const sleepMap= t.sleepVals;
      const motMap  = t.motivationVals;
      ['sedentary','light','moderate','active'].forEach((v,i)=> $('#work').options[i].textContent = workMap[i]);
      ['low','medium','high'].forEach((v,i)=> { $('#sleep').options[i].textContent = sleepMap[i]; $('#stress').options[i].textContent=sleepMap[i]; });
      ['direct','supportive','strict'].forEach((v,i)=> $('#motivation').options[i].textContent = motMap[i]);

      // Weekday labels
      const ids=['#dSat','#dSun','#dMon','#dTue','#dWed','#dThu','#dFri'];
      t.daysNames.forEach((d,i)=> $(ids[i]).textContent = d);

      // Build muscles list with per-muscle issue
      const mWrap = $('#musclesWrap'); mWrap.innerHTML='';
      t.muscleList.forEach(([key,label])=>{
        const row = document.createElement('div');
        row.innerHTML = `
          <label class="flex items-center gap-2 text-slate-300 text-sm">
            <input type="checkbox" data-muscle="${key}" class="align-middle">
            <span>${label}</span>
          </label>
          <input id="muscle_${key}" class="input mt-1" placeholder="${(lang==='ar'?'ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©/Ø§Ù„Ø³Ø¨Ø¨':'Describe the issue/reason')}" />
        `;
        mWrap.appendChild(row);
      });

      // Build medical checklist
      const ml = $('#medicalList'); ml.innerHTML='';
      t.medicalList.forEach(([key,label])=>{
        const item = document.createElement('label');
        item.className='flex items-center gap-2';
        item.innerHTML = `<input type="checkbox" value="${key}" class="align-middle"> <span>${label}</span>`;
        ml.appendChild(item);
      });
    }

    $('#btnAr').onclick = ()=>{lang='ar'; fillStatic();};
    $('#btnEn').onclick = ()=>{lang='en'; fillStatic();};

    // Theme
    let dark=true;
    const applyTheme=()=>{document.body.style.background = dark? 'linear-gradient(180deg,#0b1020,#0a0f1d)' : '#f8fafc'; document.querySelectorAll('.card').forEach(c=> c.style.background = dark? 'rgba(15,22,46,.88)':'#fff'); document.querySelectorAll('.prose-invert').forEach(p=> p.classList.toggle('prose', !dark));};
    $('#btnTheme').onclick = ()=>{dark=!dark; applyTheme();};

    // Currency auto
    try{
      const region = Intl.DateTimeFormat().resolvedOptions().locale.split('-')[1] || '';
      const map = {SA:'SAR',AE:'AED',EG:'EGP',KW:'KWD',QA:'QAR',US:'USD',GB:'USD'};
      if(map[region]) { $('#currency').value = map[region]; }
    }catch{ /* ignore */ }

    // Initial load
    fillStatic(); applyTheme();

    /* =========================
       Generate Plan (AI)
    ========================== */
    function gatherForm(){
      const days = [...document.querySelectorAll('[id="lblDays"] ~ div input:checked')].map(c=>c.value);
      const muscles = {};
      i18n[lang].muscleList.forEach(([k])=>{
        const checked = document.querySelector(`[data-muscle="${k}"]`)?.checked;
        if (checked) muscles[k] = $('#muscle_'+k).value || '';
      });
      const medical = [...$('#medicalList').querySelectorAll('input:checked')].map(i=>i.value);
      return {
        lang,
        profile:{
          name:$('#name').value.trim(),
          age:+$('#age').value || null,
          height:+$('#height').value || null,
          weight:+$('#weight').value || null,
          bodyfat: $('#bodyfat').value ? +$('#bodyfat').value : null,
          waist:   $('#waist').value ? +$('#waist').value : null,
          sex:$('#sex').value,
          targetWeight: $('#targetWeight').value ? +$('#targetWeight').value : null,
          targetDate: $('#targetDate').value || null,
        },
        lifestyle:{
          work:$('#work').value,
          steps:+$('#steps').value || 0,
          sleep:$('#sleep').value,
          stress:$('#stress').value,
          place:$('#place').value,
          session:+$('#session').value || 0,
          rhr:$('#rhr').value,
          pushups:$('#pushups').value,
          run1k:$('#run1k').value,
          days,
          equipment:$('#equipment').value,
          experience:$('#experience').value,
          rpe:$('#rpe').value,
          caffeine:$('#caffeine').value,
          injuries:$('#injuries').value
        },
        diet:{
          goals:[...document.querySelectorAll('#lblGoals ~ div input:checked')].map(i=>i.value),
          meals:+$('#meals').value,
          type:$('#dietType').value,
          cuisine:$('#cuisine').value,
          prep:+$('#prep').value||0,
          budget:$('#budget').value || null,
          currency:$('#currency').value,
          avoid:$('#avoid').value,
          motivation:$('#motivation').value,
          challenges:$('#challenges').value,
          muscles
        },
        medical:{
          list: medical,
          other: $('#otherConditions').value,
          meds:  $('#medications').value,
          supps: $('#supplements').value
        }
      };
    }

    function buildPrompt(p){
      const t = i18n[lang];
      const d = new Date();
      const welcome = (lang==='ar')
        ? `Ø§Ø¨Ø¯Ø£ Ø¨Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ ÙˆØªØ­ÙÙŠØ² Ù…Ù‡Ù†ÙŠØ© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø³ÙŠØ§Ù‚ (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø®Ø·Ø©).`
        : `Start with a single professional welcome & motivation paragraph (once at the beginning).`;

      return `
Act as "Coach Mustafa Elsafy", a certified international nutrition & fitness expert.
Language: ${lang}. Use clear headings and tables.
Respect **RTL** formatting if Arabic.

${welcome}

### User Profile
- Name: ${p.profile.name || '-'}
- Sex: ${p.profile.sex}, Age: ${p.profile.age}, Height: ${p.profile.height} cm, Weight: ${p.profile.weight} kg
- Body fat: ${p.profile.bodyfat ?? 'N/A'}%, Waist: ${p.profile.waist ?? 'N/A'} cm
- Numeric target (kg): ${p.profile.targetWeight ?? 'N/A'}, Target date: ${p.profile.targetDate ?? 'N/A'}

### Lifestyle & Training Context
- Work/Activity: ${p.lifestyle.work}, Steps/day: ${p.lifestyle.steps}
- Sleep: ${p.lifestyle.sleep}, Stress: ${p.lifestyle.stress}
- Session length: ${p.lifestyle.session} min, Place: ${p.lifestyle.place}
- Fitness test: RHR ${p.lifestyle.rhr || '-'}, Push-ups ${p.lifestyle.pushups || '-'}, 1km ${p.lifestyle.run1k || '-'}
- Available days: ${p.lifestyle.days.join(', ') || 'N/A'}
- Equipment: ${p.lifestyle.equipment || 'Bodyweight only'}
- Experience: ${p.lifestyle.experience}, RPE: ${p.lifestyle.rpe}
- Injuries/constraints: ${p.lifestyle.injuries || 'None'}

### Diet & Preferences
- Goals: ${p.diet.goals.join(', ') || 'N/A'}, Meals/day: ${p.diet.meals}
- Diet type: ${p.diet.type}, Cuisine: ${p.diet.cuisine}, Prep time: ${p.diet.prep} min
- Budget: ${p.diet.budget || 'Auto'} ${p.diet.currency}
- Avoid/allergies: ${p.diet.avoid || 'None'}
- Preferred motivation style: ${p.diet.motivation}
- Past challenges: ${p.diet.challenges || 'None'}

### Special Muscles (each with issue)
${Object.keys(p.diet.muscles).length ? Object.entries(p.diet.muscles).map(([k,v])=>`- ${k}: ${v||'-'}`).join('\n') : 'None'}

### Medical
- Flags: ${p.medical.list.join(', ') || 'None'}
- Other: ${p.medical.other || 'None'}
- Current medications: ${p.medical.meds || 'None'}
- Current supplements: ${p.medical.supps || 'None'}

### What to produce
1) **Analysis**: brief precise assessment of the case and the goal path.
2) **Allowed & Limits**: lists of allowed, limited, avoid (consider allergies/medical).
3) **Intermittent Fasting** (only if helpful for goals or medical flags): protocol, feeding window, hydration, cautions.
4) **Daily Nutrition Plan (7 days)**: For each day produce all meals (as many as meals/day), with grams, macros and kcal totals. No placeholders. Distinct menus across 7 days.
5) **Training Plan (7 days)**: For each training day, list exercises (English names), sets/reps, tempo/RPE/rest, cardio (type/duration/HR zone). Adapt to experience and injuries and focused muscles.
6) **Supplements**: tailored to goals and medical flags with dosage, timing, and cautions.
7) **Progression**: how to progress weekly (load, volume, steps).
8) **Troubleshooting**: common issues and fixes.
9) **Safety**: red-flags and when to seek medical advice.
10) **Closing**: short commitment message.

Use neat Markdown with clear headings. Avoid repeating the welcome paragraph in later sections.
`;
    }

    async function callAI(prompt){
      const res = await fetch('/.netlify/functions/gemini-proxy', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ prompt })
      });
      if(!res.ok){ throw new Error(await res.text()); }
      return res.json();
    }

    $('#btnGenerate').onclick = async (e)=>{
      e.preventDefault();
      const data = gatherForm();
      if(!data.profile.name || !data.profile.age || !data.profile.height || !data.profile.weight){
        alert( lang==='ar' ? 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: Ø§Ù„Ø§Ø³Ù…/Ø§Ù„Ø¹Ù…Ø±/Ø§Ù„Ø·ÙˆÙ„/Ø§Ù„ÙˆØ²Ù†.' : 'Please complete name/age/height/weight.' );
        return;
      }
      $('#wait').classList.remove('hidden');
      $('#plan').innerHTML='';
      try{
        const prompt = buildPrompt(data);
        const ai = await callAI(prompt);
        const html = marked.parse(ai.text || '');
        $('#plan').innerHTML = html;
      }catch(err){
        $('#plan').innerHTML = `<div class="text-red-400 text-sm whitespace-pre-wrap">${String(err).slice(0,800)}</div>`;
      }finally{
        $('#wait').classList.add('hidden');
        window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'});
      }
    };

    $('#btnPrint').onclick = (e)=>{ e.preventDefault(); window.print(); };
    $('#btnPDF').onclick   = (e)=>{ e.preventDefault(); window.print(); }; // same action in browser

  </script>
</body>
</html>
